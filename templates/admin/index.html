{% extends "admin/index.html" %}
{% load i18n log admin_dashboard %}

{% block sidebar %}
<div id="content-related" class="rwl-right-layout">
    <div class="module" id="recent-actions-module">
        <h2>{% translate 'Recent actions' %}</h2>
        <h3>{% translate 'My actions' %}</h3>
        {% get_admin_log 10 as admin_log for_user user %}
        {% if not admin_log %}
            <p>{% translate 'None available' %}</p>
        {% else %}
            <ul class="actionlist">
            {% for entry in admin_log %}
            <li class="{% if entry.is_addition %}addlink{% endif %}{% if entry.is_change %}changelink{% endif %}{% if entry.is_deletion %}deletelink{% endif %}">
                {% if entry.is_deletion or not entry.get_admin_url %}
                    {{ entry.object_repr }}
                {% else %}
                    <a href="{{ entry.get_admin_url }}">{{ entry.object_repr }}</a>
                {% endif %}
                <br>
                {% if entry.content_type %}
                    <span class="mini quiet">{% filter capfirst %}{{ entry.content_type.name }}{% endfilter %}</span>
                {% else %}
                    <span class="mini quiet">{% translate 'Unknown content' %}</span>
                {% endif %}
            </li>
            {% endfor %}
            </ul>
        {% endif %}
    </div>

    <div class="rwl-capsule-column">
        <section class="module rwl-capsule-module">
            <h2>Задачи</h2>
            {% latest_tasks 9 as task_items %}
            {% if task_items %}
            <div class="rwl-card-list">
                {% for task in task_items %}
                <article class="rwl-object-card">
                    <header class="rwl-object-card__title">
                        <a href="{% url 'admin:core_task_change' task.id %}">Task #{{ task.id }}</a>
                    </header>
                    <div class="rwl-object-card__meta">{{ task.status }}{% if task.assignee %} • {{ task.assignee.username }}{% endif %}</div>
                    <div class="rwl-object-card__meta">{{ task.created_at|date:"d.m.Y H:i" }}</div>
                </article>
                {% endfor %}
            </div>
            {% else %}
            <p>{% translate 'None available' %}</p>
            {% endif %}
        </section>

        <section class="module rwl-capsule-module">
            <h2>Заказы</h2>
            {% latest_orders 9 as order_items %}
            {% if order_items %}
            <div class="rwl-card-list">
                {% for order in order_items %}
                <article class="rwl-object-card">
                    <header class="rwl-object-card__title">
                        <a href="{% url 'admin:core_order_change' order.id %}">Order #{{ order.id }}</a>
                    </header>
                    <div class="rwl-object-card__meta">{{ order.client.full_name|default:"Без клиента" }} • {{ order.status }}</div>
                    <div class="rwl-object-card__meta">{{ order.created_at|date:"d.m.Y H:i" }}</div>
                </article>
                {% endfor %}
            </div>
            {% else %}
            <p>{% translate 'None available' %}</p>
            {% endif %}
        </section>

        <section class="module rwl-capsule-module">
            <h2>Папка Импорта</h2>
            {% latest_imports 2 as import_items %}
            {% if import_items %}
            <div class="rwl-card-list">
                {% for item in import_items %}
                <article class="rwl-object-card">
                    <header class="rwl-object-card__title">
                        <a href="{% url 'admin:imports_importbatch_change' item.id %}">Import #{{ item.id }}</a>
                    </header>
                    <div class="rwl-object-card__meta">{{ item.source_file_name|default:"Файл не указан" }}</div>
                    <div class="rwl-object-card__meta">{{ item.status }} • {{ item.created_at|date:"d.m.Y H:i" }}</div>
                </article>
                {% endfor %}
            </div>
            {% else %}
            <p>{% translate 'None available' %}</p>
            {% endif %}
        </section>
    </div>
</div>
{% endblock %}
